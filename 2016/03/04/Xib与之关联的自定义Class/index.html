<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Xib与之关联的自定义Class | 寒流‘s Blog | 编程与生活</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="drawRect,xib">
  <meta name="description" content="最近遇到了一个问题：点击【猜你喜欢】视图进入商品详情后，再返回到首页时，没有原先的数据了。 打开Reveal看了下层级关系，原来是被二次生成的界面覆盖了。再细看一下，上面的视图都被二次生成了。真是哔了狗了！">
<meta property="og:type" content="article">
<meta property="og:title" content="Xib与之关联的自定义Class">
<meta property="og:url" content="http://koalahl.github.io/2016/03/04/Xib与之关联的自定义Class/index.html">
<meta property="og:site_name" content="寒流‘s Blog">
<meta property="og:description" content="最近遇到了一个问题：点击【猜你喜欢】视图进入商品详情后，再返回到首页时，没有原先的数据了。 打开Reveal看了下层级关系，原来是被二次生成的界面覆盖了。再细看一下，上面的视图都被二次生成了。真是哔了狗了！">
<meta property="og:image" content="http://koalahl.github.io/img/被新生成的view覆盖.png">
<meta property="og:image" content="http://koalahl.github.io/img/reveal view UI hierarchy 2.png">
<meta property="og:image" content="http://koalahl.github.io/img/reveal view UI hierarchy.png">
<meta property="og:image" content="http://lenorephoto.b0.upaiyun.com/7283e0c4e156f2a6.jpg">
<meta property="og:updated_time" content="2016-03-04T12:30:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xib与之关联的自定义Class">
<meta name="twitter:description" content="最近遇到了一个问题：点击【猜你喜欢】视图进入商品详情后，再返回到首页时，没有原先的数据了。 打开Reveal看了下层级关系，原来是被二次生成的界面覆盖了。再细看一下，上面的视图都被二次生成了。真是哔了狗了！">
  
    <link rel="alternative" href="/atom.xml" title="寒流‘s Blog" type="application/atom+xml">
  
  <meta name="summary" content="&lt;p&gt;最近遇到了一个问题：点击【猜你喜欢】视图进入商品详情后，再返回到首页时，没有原先的数据了。&lt;br&gt; &lt;img src=&quot;/img/被新生成的view覆盖.png&quot; width = &quot;300&quot; height = &quot;588&quot; alt=&quot;被新生成的view覆盖&quot; align=center /&gt;&lt;br&gt;打开Reveal看了下层级关系，原来是被二次生成的界面覆盖了。再细看一下，上面的视图都被二次生成了。真是哔了狗了！&lt;br&gt;&lt;img src=&quot;/img/reveal view UI hierarchy 2.png&quot; alt=&quot;reveal view UI hierarchy&quot;&gt;&lt;br&gt;&lt;img src=&quot;/img/reveal view UI hierarchy.png&quot; alt=&quot;reveal view UI hierarchy&quot;&gt;&lt;br&gt;">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="loading" class="active"></div>

  <nav id="menu" class="hide" >
   <div class="inner">
  <a href="javascript:;" class="header-icon waves-circle-light" id="menu-off">
      <i class="icon icon-lg icon-close"></i>
  </a>
  <div class="brand-wrap">
    <div class="brand">
      <a href="/" class="avatar"><img src="/img/avatar.png"></a>
      <hgroup class="introduce">
        <h5 class="nickname">Han Liu</h5>
        <a href="mailto:hanangellove@icloud.com" title="hanangellove@icloud.com" class="mail">hanangellove@icloud.com</a>
      </hgroup>
    </div>
  </div>
  <ul class="nav">
    
        <li class="waves-block">
          <a href="/"  >
            <i class="icon icon-lg icon-home"></i>
            主页
          </a>
        </li>
    
        <li class="waves-block">
          <a href="/archives"  >
            <i class="icon icon-lg icon-archives"></i>
            Archives
          </a>
        </li>
    
        <li class="waves-block">
          <a href="/tags"  >
            <i class="icon icon-lg icon-tags"></i>
            Tags
          </a>
        </li>
    
        <li class="waves-block">
          <a href="https://github.com/koalahl" target="_blank" >
            <i class="icon icon-lg icon-github"></i>
            Github
          </a>
        </li>
    
        <li class="waves-block">
          <a href="http://weibo.com/1619592223/" target="_blank" >
            <i class="icon icon-lg icon-weibo"></i>
            Weibo
          </a>
        </li>
    
        <li class="waves-block">
          <a href="https://twitter.com/hanangellove" target="_blank" >
            <i class="icon icon-lg icon-twitter"></i>
            Twitter
          </a>
        </li>
    
        <li class="waves-block">
          <a href="http://hexo.io/"  >
            <i class="icon icon-lg icon-link"></i>
            Hexo
          </a>
        </li>
    
  </ul>

  <footer class="footer">
  <p><a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>
  <p>寒流‘s Blog &copy; 2016</p>
  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme
  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>
  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"> </i></a>

</footer>

</div>

  </nav>
  <main id="main">
    <header class="header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-circle-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Xib与之关联的自定义Class</div>
        
    </div>
</header>
<header class="content-header">
  <div class="container">
    <h1 class="author">Xib与之关联的自定义Class</h1>
    <h5 class="subtitle">2016-03-04</h5>
  </div>
</header>

    <div class="container body-wrap">
      
  <article id="post-Xib与之关联的自定义Class" class="article article-type-post" itemprop="blogPost">
    
      <div class="post-meat flex-row">
        <div class="flex-col">
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/drawRect/">drawRect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xib/">xib</a></li></ul>
</div>
      </div>
      <div class="post-body">

        <aside class="post-widget" id="post-widget">

          

          
          <nav class="post-toc-wrap" id="post-toc">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-text">drawRect方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-text">总结</span></a></li></ol>
          </nav>
          
        </aside>

        <div class="post-main">

            <div class="post-content" id="post-content" itemprop="postContent"><p>最近遇到了一个问题：点击【猜你喜欢】视图进入商品详情后，再返回到首页时，没有原先的数据了。<br> <img src="/img/被新生成的view覆盖.png" width="300" height="588" alt="被新生成的view覆盖" align="center"><br>打开Reveal看了下层级关系，原来是被二次生成的界面覆盖了。再细看一下，上面的视图都被二次生成了。真是哔了狗了！<br><img src="/img/reveal view UI hierarchy 2.png" alt="reveal view UI hierarchy"><br><img src="/img/reveal view UI hierarchy.png" alt="reveal view UI hierarchy"><br><a id="more"></a></p>
<p></p><h2><code>drawRect</code>方法</h2><br>好吧，修改代码吧。因为这些视图都是在xib上创建好了，另外新建了与之对应的自定义类，所以都直接用的<code>drawRect</code>方法去初始化UI元素。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)drawRect:(CGRect)rect &#123;&#10;&#10;    [self initSubViews];&#10;&#125;</span><br></pre></td></tr></table></figure><p></p>
<blockquote><p>The default implementation of this method does nothing. Subclasses that use technologies such as Core Graphics and UIKit to draw their view’s content should override this method and implement their drawing code there. You do not need to override this method if your view sets its content in other ways. For example, you do not need to override this method if your view just displays a background color or if your view sets its content directly using the underlying layer object.</p>
<p>If you subclass UIView directly, your implementation of this method does not need to call super. However, if you are subclassing a different view class, you should call super at some point in your implementation.<br>This method is called when a view is first displayed or when an event occurs that invalidates a visible part of the view. You should never call this method directly yourself. To invalidate part of your view, and thus cause that portion to be redrawn, call the setNeedsDisplay or setNeedsDisplayInRect: method instead.</p>
<footer><strong>@Apple Develop</strong><cite><a href="https://developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIView_Class/index.html#//apple_ref/swift/instm/UIView/c:objc(cs)UIView(im)drawRect:" target="_blank" rel="external">developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIView_Class/index.html#//apple_ref/swift/instm/UIView/c:objc(cs)UIView(im)drawRect:</a></cite></footer></blockquote>
<p>这里就出现了问题。在每次重新返回到首页后，<code>drawRect</code>方法又被重新调用了一次，所以生成了新的视图覆盖了原来的视图，但是又没有请求数据，所以就看不到了。<br><blockquote><p>drawRect方法只被重新调用了一次，在这之后就不会再被调用。</p>
</blockquote></p>
<p>因为为了解决这个问题，我就不用<code>drawRect</code>去初始化页面元素了，而是用了<code>initWithCorder</code>方法。<br>注意因为视图是被直接创建在xib上的，并没有执行<code>initWithFrame</code>方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)initWithCoder:(NSCoder *)aDecoder&#123;&#10;    self = [super initWithCoder:aDecoder];&#10;    if (self) &#123;&#10;        [self initSubViews];&#10;    &#125;&#10;    &#10;    return self;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p></p><h2>总结</h2><br>1.尽量不要使用drawRect方法，性能下降厉害撒。<br>2.已经在xib上创建的视图，与其关联的子类中<code>initWithFrame</code>方法不会被调用。<p></p>
<div align="center"><br>    <img src="http://lenorephoto.b0.upaiyun.com/7283e0c4e156f2a6.jpg" alt="girl"><br></div>


</div>

            
<nav class="post-nav flex-row">
  <div class="flex-col waves-block prev">
    
      <a href="/2016/03/05/QRCode的那些事儿/" title="QRCode与Core Image" id="post-prev" class="post-nav-link">
        <i class="icon icon-chevron-left"></i>
        <span class="article-nav-title">上一篇</span>
      </a>
    
  </div>
  <div class="flex-col waves-block next">
    
      <a href="/2016/02/28/移动IM开发要点/" title="移动IM开发要点" id="post-next" class="post-nav-link">
        <span class="article-nav-title">下一篇</span>
        <i class="icon icon-chevron-right"></i>
      </a>
    
  </div>

</nav>



            


<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'hanangellove'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



        </div>

      </div>

    

  </article>



    </div>
  </main>
<div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-circle-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script src="/js/main.js" type="text/javascript"></script>








</body>
</html>
