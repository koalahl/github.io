<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Xib与之关联的自定义Class | 寒流‘s Blog | 编程与生活</title>

  
  <meta name="author" content="Han Liu">
  

  
  <meta name="description" content="Thinking in Different">
  

  
  
  <meta name="keywords" content="drawRect,xib">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Xib与之关联的自定义Class"/>

  <meta property="og:site_name" content="寒流‘s Blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="寒流‘s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">寒流‘s Blog</a>
    </h1>
    <p class="site-description">编程与生活</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/tags">标签</a></li>
      
        <li><a href="/about">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>Xib与之关联的自定义Class</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2016/03/04/Xib与之关联的自定义Class/" rel="bookmark">
        <time class="entry-date published" datetime="2016-03-04T01:37:46.000Z">
          2016-03-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>最近遇到了一个问题：点击【猜你喜欢】视图进入商品详情后，再返回到首页时，没有原先的数据了。<br> <img src="/img/被新生成的view覆盖.png" width="300" height="588" alt="被新生成的view覆盖" align="center"><br>打开Reveal看了下层级关系，原来是被二次生成的界面覆盖了。再细看一下，上面的视图都被二次生成了。真是哔了狗了！<br><img src="/img/reveal view UI hierarchy 2.png" alt="reveal view UI hierarchy"><br><img src="/img/reveal view UI hierarchy.png" alt="reveal view UI hierarchy"><br><a id="more"></a></p>
<p></p><h2><code>drawRect</code>方法</h2><br>好吧，修改代码吧。因为这些视图都是在xib上创建好了，另外新建了与之对应的自定义类，所以都直接用的<code>drawRect</code>方法去初始化UI元素。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)drawRect:(CGRect)rect &#123;&#10;&#10;    [self initSubViews];&#10;&#125;</span><br></pre></td></tr></table></figure><p></p>
<blockquote><p>The default implementation of this method does nothing. Subclasses that use technologies such as Core Graphics and UIKit to draw their view’s content should override this method and implement their drawing code there. You do not need to override this method if your view sets its content in other ways. For example, you do not need to override this method if your view just displays a background color or if your view sets its content directly using the underlying layer object.</p>
<p>If you subclass UIView directly, your implementation of this method does not need to call super. However, if you are subclassing a different view class, you should call super at some point in your implementation.<br>This method is called when a view is first displayed or when an event occurs that invalidates a visible part of the view. You should never call this method directly yourself. To invalidate part of your view, and thus cause that portion to be redrawn, call the setNeedsDisplay or setNeedsDisplayInRect: method instead.</p>
<footer><strong>@Apple Develop</strong><cite><a href="https://developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIView_Class/index.html#//apple_ref/swift/instm/UIView/c:objc(cs)UIView(im)drawRect:" target="_blank" rel="external">developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIView_Class/index.html#//apple_ref/swift/instm/UIView/c:objc(cs)UIView(im)drawRect:</a></cite></footer></blockquote>
<p>这里就出现了问题。在每次重新返回到首页后，<code>drawRect</code>方法又被重新调用了一次，所以生成了新的视图覆盖了原来的视图，但是又没有请求数据，所以就看不到了。<br><blockquote><p>drawRect方法只被重新调用了一次，在这之后就不会再被调用。</p>
</blockquote></p>
<p>因为为了解决这个问题，我就不用<code>drawRect</code>去初始化页面元素了，而是用了<code>initWithCorder</code>方法。<br>注意因为视图是被直接创建在xib上的，并没有执行<code>initWithFrame</code>方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)initWithCoder:(NSCoder *)aDecoder&#123;&#10;    self = [super initWithCoder:aDecoder];&#10;    if (self) &#123;&#10;        [self initSubViews];&#10;    &#125;&#10;&#10;    return self;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p></p><h2>总结</h2><br>1.尽量不要使用drawRect方法，性能下降厉害撒。<br>2.已经在xib上创建的视图，与其关联的子类中<code>initWithFrame</code>方法不会被调用。<p></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/iOS/">iOS</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/drawRect/">drawRect</a><a href="/tags/xib/">xib</a>
    </span>
    

    </div>

    
  </div>
</article>

  
	<section id="comments" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'hanangellove';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>





    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2017 Han Liu
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>